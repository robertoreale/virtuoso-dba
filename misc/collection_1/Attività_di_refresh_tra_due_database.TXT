
******
Fase1 
*****Estrazione dei DDL Dell'utenti del refresh dal db di orgine ********* 


-- user_clone.sql

set lines 999 pages 999
set verify off
set feedback off
set heading off

select	username
from	dba_users
order	by username
/



select username
,      created
from   dba_users
where  lower(username) = lower('&user')
/



spool user_clone_&&userid.sql

select 'create user ' || '&&userid' ||
       ' identified by values '''||password ||
       ''' default tablespace ' || default_tablespace ||
       ' temporary tablespace ' || temporary_tablespace || ';' "user"
from   dba_users
where  username = '&&userid'
/

select 'alter user &&userid quota '||
       decode(max_bytes, -1, 'unlimited'
       ,                     ceil(max_bytes / 1024 / 1024) || 'M') ||
       ' on ' || tablespace_name || ';'
from   dba_ts_quotas
where  username = '&&userid'
/

select 'grant ' ||granted_role || ' to &&userid' ||
       decode(admin_option, 'NO', ';', 'YES', ' with admin option;') "ROLE"
from   dba_role_privs
where  grantee = '&&userid'
/

select 'grant ' || privilege || ' to &&userid' ||
       decode(admin_option, 'NO', ';', 'YES', ' with admin option;') "PRIV"
from   dba_sys_privs
where  grantee = '&&userid'
/

spool off

per le grant ----
select 'grant '||privilege||' on '||owner||'.'||table_name||' to '||grantee||';' from dba_tab_privs where grantor = '&&userid';

undefine user

set verify on
set feedback on
set heading on

@/tmp/user_clone_tmp.sql

!rm /tmp/user_clone_tmp.sql

 
  
Copyright 


*****
Fase2
*******o fare l'export della struttura no rows vedi dettaglio******* 

exp system/pwd_1iol file=exp_HISTORY.dmp log=exp_HISTORY_070809.log BUFFER=140000 owner=HISTORY rows=n


*****
Fase3
*********fare l'export degli owner interessati dal refresh possibilmente se di grosse dimensione su più file di dmp con rows=Y


exp system/pwd_1iol file=exp_HISTORY.dmp log=exp_HISTORY_070809.log BUFFER=140000 owner=HISTORY 

*****
Fase4
*********droppare e ricreare l'utenti interessati su database di destinazione 

drop user MEMBERSHIP cascade


*****
Fase5
*********ricreare gli utenti interessati sull db di destinazione usando gli scripts ricavati dall' db di origine DALLA FASE1 

@/tmp/user_clone_tmp.sql

*****
Fase6
*********Fare l'import from user touser del dmp del db di origine vedi dettaglio*****


imp system/sololajuve file=exp_crmweb.dmp log=migra_MEMBER_WORK.log buffer=4000 frouser=MEMBERSHIP touser=MEMBERSHIP 
